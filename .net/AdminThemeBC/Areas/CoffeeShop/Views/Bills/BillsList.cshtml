@model System.Data.DataTable
<main id="main" class="main">
    @if (TempData["ErrorMsg"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMsg"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["SuccessMsg"] != null)
    {
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                successAlertFire('@TempData["SuccessMsg"]');
            });
        </script>
    }
    <div class="card-body">
        <h5 class="card-title fs-3">Bills</h5>
        <div class="my-3">
            <a asp-area="CoffeeShop" asp-controller="Bills" asp-action="AddEditBill">
                <button class="btn btn-outline-info">Add New Bill</button>
            </a>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">BillNumber</th>
                    <th scope="col">BillDate</th>
                    <th scope="col">Order Name</th>
                    <th scope="col">TotalAmount</th>
                    <th scope="col">Discount</th>
                    <th scope="col">NetAmount</th>
                    <th scope="col">User Name</th>
                    <th scope="col" class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (System.Data.DataRow row in Model.Rows)
                {
                    <tr>
                        <td scope="col">@row["BillNumber"]</td>
                        <td scope="col">@row["BillDate"].ToString().Split(" ")[0]</td>
                        <td scope="col">@row["OrderName"]</td>
                        <td scope="col">@row["TotalAmount"]</td>
                        <td scope="col">@row["Discount"]</td>
                        <td scope="col">@row["NetAmount"]</td>
                        <td scope="col">@row["UserName"]</td>
                        <td scope="col" class="text-center">
                            <a asp-controller="Bills" asp-action="AddEditBill" asp-route-BillID="@row["BillID"]" class="btn btn-success py-0">Edit</a>
                            <button class="btn btn-danger py-0 delete-button" data-id="@row["BillID"]">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</main>

<script>
    function successAlertFire(msg) {
        Swal.fire({
            position: "top",
            icon: "success",
            title: msg,
            showConfirmButton: false,
            timer: 1500
        });
        setTimeout(() => {
            window.location.reload();
        }, 1500)
    }

    document.addEventListener('DOMContentLoaded', function () {
        const deleteButtons = document.querySelectorAll('.delete-button');

        deleteButtons.forEach(button => {
            button.addEventListener('click', function () {
                const billId = this.getAttribute('data-id');

                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = `/CoffeeShop/Bills/BillDelete?BillID=${billId}`;
                    }
                });
            });
        });
    });
</script>
